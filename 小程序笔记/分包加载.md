---
title: 分包加载
date: 2026-02-11
tags: [#微信小程序]
---

# 分包加载

## 什么是分包加载

分包加载是微信小程序提供的一种优化技术，允许开发者将小程序划分为**主包**和多个**分包**，按需下载和加载，从而提升小程序的启动速度和性能。

## 分包的作用与目的

- **提高首屏加载速度**：用户打开小程序时只需下载主包，分包在需要时再加载
- **突破包大小限制**：主包大小不能超过 **2MB**，通过分包可以扩展总体积（所有分包总大小不超过 **30MB**）
- **多团队协作解耦**：不同团队可以独立开发各自的分包，降低代码耦合度

## 分包类型

### 普通分包

普通分包是最常用的分包方式，在 `app.json` 中通过 `subpackages` 字段声明：

```json
{
  "pages": [
    "pages/index/index"
  ],
  "subpackages": [
    {
      "root": "packageA",
      "pages": [
        "pages/cat/cat",
        "pages/dog/dog"
      ]
    },
    {
      "root": "packageB",
      "name": "pack2",
      "pages": [
        "pages/apple/apple",
        "pages/banana/banana"
      ]
    }
  ]
}
```

**注意事项：**
- 普通分包**必须依赖主包**，需要等待主包下载完成后才能运行
- 分包可以引用主包的公共资源（如公共组件、JS 工具库等）
- 分包之间**不能相互引用**对方的资源

### 独立分包

独立分包是一种特殊的分包，可以**不依赖主包独立运行**，适用于需要极速访问的场景（如活动页、广告页等）。

```json
{
  "subpackages": [
    {
      "root": "packageC",
      "pages": [
        "pages/promotion/promotion"
      ],
      "independent": true
    }
  ]
}
```

**独立分包 vs 普通分包：**

| 特性 | 普通分包 | 独立分包 |
|------|---------|---------|
| 依赖主包 | 是 | 否 |
| 可独立启动 | 否 | 是 |
| 引用主包资源 | 可以 | 不可以 |
| 使用 `app.wxss` | 可以 | 不可以 |
| 使用插件 | 可以 | 不可以 |
| 适用场景 | 常规业务页面 | 活动页、临时落地页 |

## 分包预下载

为了进一步优化用户体验，可以配置**分包预下载**，在进入某个页面时提前下载指定分包：

```json
{
  "preloadRule": {
    "pages/index/index": {
      "network": "all",
      "packages": ["packageA"]
    },
    "pages/main/main": {
      "network": "wifi",
      "packages": ["packageB"]
    }
  }
}
```

- `network`：预下载的网络条件，可选 `all`（所有网络）或 `wifi`（仅 WiFi）
- `packages`：需要预下载的分包名称或 `root` 路径

## 插件

插件是一种可复用的功能模块，可以将独立的功能抽取为插件，方便在不同小程序之间共享：

- 插件由开发者发布，其他小程序可直接引用
- 插件拥有独立的 API 接口和页面
- 适合封装通用业务逻辑，如支付、地图、客服等功能

## 最佳实践

1. **合理划分分包**：将访问频率低的页面放入分包，保持主包精简
2. **善用独立分包**：对于活动页等需要快速访问的页面，使用独立分包
3. **配置预下载**：根据用户行为路径，提前预下载可能访问的分包
4. **控制包体积**：定期检查各分包大小，避免单个分包过大
5. **公共资源放主包**：被多个分包引用的资源应放在主包中，避免重复打包
